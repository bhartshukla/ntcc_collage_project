<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CropGuard - Rice Cultivation Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }
        .disease-row:hover {
            background-color: #f0fdf4;
        }
        .star-rating {
            color: #f59e0b;
            font-size: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-green-800 mb-2">CropGuard</h1>
            <p class="text-gray-600">Comprehensive rice cultivation analysis and disease prevention tool</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Form Column -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-green-700 mb-4">Input Parameters</h2>
                
                <form id="cropForm">
                    <div class="mb-4">
                        <label for="district" class="block text-sm font-medium text-gray-700 mb-1">Select District</label>
                        <select id="district" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <option value="">-- Select District --</option>
                            <option value="Lucknow">Lucknow</option>
                            <option value="Agra">Agra</option>
                            <option value="Gorakhpur">Gorakhpur</option>
                            <option value="Varanasi">Varanasi</option>
                            <option value="Jhansi">Jhansi</option>
                        </select>
                    </div>

                     <div class="mb-4">
                            <label for="soilTexture" class="block text-sm font-medium text-gray-700 mb-1">Soil Texture</label>
                            <select id="soilTexture" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                                <option value="">Select Soil Texture</option>
                                <option value="Clay Loam">Clay Loam</option>
                                <option value="Silty Clay Loam">Silty Clay Loam</option>
                                <option value="Silty Loam">Silty Loam </option>
                                <option value="Clay">Clay</option>
                               
                            </select>
                        </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="mb-4">
                            <label for="soilPh" class="block text-sm font-medium text-gray-700 mb-1">Soil pH</label>
                            <input type="number" step="0.1" id="soilPh" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ideal: 6.0–6.8</p>
                        </div>

                        <div class="mb-4">
                            <label for="soilMoisture" class="block text-sm font-medium text-gray-700 mb-1">Soil Moisture (%)</label>
                            <input type="number" id="soilMoisture" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ideal: 70–80%</p>
                        </div>

                       

                        <div class="mb-4">
                            <label for="nitrogen" class="block text-sm font-medium text-gray-700 mb-1">Nitrogen (N) kg/ha</label>
                            <input type="number" id="nitrogen" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ideal: 120–150</p>
                        </div>

                        <div class="mb-4">
                            <label for="phosphorus" class="block text-sm font-medium text-gray-700 mb-1">Phosphorus (P) kg/ha</label>
                            <input type="number" id="phosphorus" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ideal: 40–60</p>
                        </div>

                        <div class="mb-4">
                            <label for="potassium" class="block text-sm font-medium text-gray-700 mb-1">Potassium (K) kg/ha</label>
                            <input type="number" id="potassium" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ideal: 40–60</p>
                        </div>

                        <div class="mb-4">
                            <label for="temperature" class="block text-sm font-medium text-gray-700 mb-1">Temperature (°C)</label>
                            <input type="number" step="0.1" id="temperature" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ideal: 28–32</p>
                        </div>

                        <div class="mb-4">
                            <label for="humidity" class="block text-sm font-medium text-gray-700 mb-1">Humidity (%)</label>
                            <input type="number" id="humidity" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ideal: 65–85</p>
                        </div>

                        <div class="mb-4">
                            <label for="rainfall" class="block text-sm font-medium text-gray-700 mb-1">Rainfall (mm)</label>
                            <input type="number" id="rainfall" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-500 mt-1">Ideal: 1000–1200</p>
                        </div>
                    </div>

                    <div class="flex justify-between mt-6">
                        <button type="button" id="resetBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                            <i class="fas fa-redo mr-2"></i>Reset
                        </button>
                        <button type="button" id="calculateBtn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                            <i class="fas fa-calculator mr-2"></i>Calculate
                        </button>
                    </div>
                </form>
            </div>

            <!-- Results Column -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-green-700">Analysis Results</h2>
                    <button id="diseaseBtn" class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i class="fas fa-bug mr-1"></i>View Diseases
                    </button>
                </div>

                <div id="resultsContainer" class="space-y-4">
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-leaf text-4xl mb-2"></i>
                        <p>Enter parameters and click Calculate to see results</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Disease Modal -->
    <div id="diseaseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-green-800">Rice Disease Information</h3>
                    <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Disease</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Triggers</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symptoms</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prevention</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <!-- Rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Fertilizer Modal -->
    <div id="fertilizerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-green-800">Detailed Fertilizer Recommendations</h3>
                    <button id="closeFertilizerModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="fertilizerDetails">
                    <!-- Content will be inserted by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // District data
        const districtData = [
            {
                "district": "Lucknow",
                "pH": 6.9,
                "moisture": 72,
                "nitrogen": 198,
                "phosphorus": 20,
                "potassium": 174,
                "temperature": 29.5,
                "humidity": 78,
                "rainfall": 920
            },
            {
                "district": "Agra",
                "pH": 6.3,
                "moisture": 65,
                "nitrogen": 190,
                "phosphorus": 18,
                "potassium": 180,
                "temperature": 30.8,
                "humidity": 70,
                "rainfall": 890
            },
            {
                "district": "Gorakhpur",
                "pH": 6.6,
                "moisture": 78,
                "nitrogen": 220,
                "phosphorus": 26,
                "potassium": 165,
                "temperature": 28.5,
                "humidity": 84,
                "rainfall": 1150
            },
            {
                "district": "Varanasi",
                "pH": 6.0,
                "moisture": 68,
                "nitrogen": 130,
                "phosphorus": 27,
                "potassium": 229,
                "temperature": 30.2,
                "humidity": 80,
                "rainfall": 960
            },
            {
                "district": "Jhansi",
                "pH": 7.06,
                "moisture": 64,
                "nitrogen": 178,
                "phosphorus": 8.5,
                "potassium": 189,
                "temperature": 31.2,
                "humidity": 68,
                "rainfall": 885
            }
        ];

        // Soil texture ratings
        const soilTextureRatings = {
            "Clay Loam": 5,
            "Silty Clay Loam": 4.5,
            "Silty Loam": 4,
            "Clay": 3,
        };

        // Disease data
        const diseaseData = [
            {
                "name": "Blast Disease",
                "triggers": "N > 160, Humidity > 85%, Moisture > 80%",
                "symptoms": "Gray diamond spots",
                "prevention": "Reduce N, space planting, use resistant varieties"
            },
            {
                "name": "Bacterial Leaf Blight",
                "triggers": "Humidity > 90%, Rainfall > 1200 mm",
                "symptoms": "Leaf tip yellowing",
                "prevention": "Clean seeds, reduce wounds, manage water"
            },
            {
                "name": "Sheath Blight",
                "triggers": "N > 150, Moisture > 85%, Dense sowing",
                "symptoms": "Rot on lower sheath",
                "prevention": "Less N, better spacing, early fungicide"
            },
            {
                "name": "Brown Spot",
                "triggers": "P < 40, K < 40, Rainfall < 900",
                "symptoms": "Brown leaf spots with halo",
                "prevention": "Balance P & K, irrigation, seed treatment"
            },
            {
                "name": "Tungro Virus",
                "triggers": "High humidity, Late sowing",
                "symptoms": "Orange-yellow leaves, stunting",
                "prevention": "Early sowing, vector control"
            },
            {
                "name": "Stem Rot",
                "triggers": "Continuous cropping, high organic matter",
                "symptoms": "Hollow tillers, rot at base",
                "prevention": "Crop rotation, drainage"
            },
            {
                "name": "False Smut",
                "triggers": "High humidity + rain at flowering",
                "symptoms": "Green smut balls",
                "prevention": "Remove infected grains, fungicide"
            },
            {
                "name": "Leaf Scald",
                "triggers": "Excess N, high humidity",
                "symptoms": "Brown water-soaked lesions",
                "prevention": "Split nitrogen doses"
            },
            {
                "name": "Narrow Brown Spot",
                "triggers": "K < 40, Excess N, low light",
                "symptoms": "Narrow brown lesions",
                "prevention": "Potassium-rich fertilizer"
            }
        ];

        // Fertilizer recommendation data
        const fertilizerData = [
            {
                "nutrient": "Nitrogen (N)",
                "conditions": [
                    {
                        "range": "N < 100 kg/ha",
                        "issues": [
                            "Slow plant growth",
                            "Yellowing of older leaves",
                            "Low tillering",
                            "Short panicles"
                        ],
                        "diseases": [
                            "Stunted Growth",
                            "Reduced grain yield",
                            "Early leaf senescence"
                        ],
                        "fertilizer": {
                            "type": "Urea",
                            "recommended_kg_per_ha": "60–80",
                            "application_method": "50% during transplanting, 50% at tillering"
                        }
                    },
                    {
                        "range": "100 ≤ N < 120 kg/ha",
                        "issues": [
                            "Light green leaves",
                            "Moderate growth delay"
                        ],
                        "diseases": [
                            "Low panicle number",
                            "Poor grain filling"
                        ],
                        "fertilizer": {
                            "type": "Urea",
                            "recommended_kg_per_ha": "40–60",
                            "application_method": "Split between early and mid-growth stages"
                        }
                    },
                    {
                        "range": "N > 150 kg/ha",
                        "issues": [
                            "Excessive vegetative growth",
                            "Delayed maturity",
                            "Lodging of plants"
                        ],
                        "diseases": [
                            "Blast Disease",
                            "Sheath Blight",
                            "False Smut",
                            "Leaf Scald",
                            "Narrow Brown Spot"
                        ],
                        "fertilizer": {
                            "type": "Urea",
                            "recommended_kg_per_ha": "No Urea required",
                            "application_method": "Avoid further N use; split in future cycles"
                        }
                    }
                ]
            },
            {
                "nutrient": "Phosphorus (P)",
                "conditions": [
                    {
                        "range": "P < 40 kg/ha",
                        "issues": [
                            "Dark green or purplish leaves",
                            "Delayed flowering and maturity",
                            "Weak root system"
                        ],
                        "diseases": [
                            "Brown Spot",
                            "Delayed panicle emergence",
                            "Tungro Virus risk increases"
                        ],
                        "fertilizer": {
                            "type": "DAP",
                            "recommended_kg_per_ha": "50–60",
                            "application_method": "Apply during land prep or basal stage"
                        }
                    },
                    {
                        "range": "40 ≤ P ≤ 60 kg/ha",
                        "issues": [
                            "Mild growth limitations",
                            "Slight delay in flowering"
                        ],
                        "diseases": [
                            "Weak spikelet formation"
                        ],
                        "fertilizer": {
                            "type": "DAP",
                            "recommended_kg_per_ha": "30–40",
                            "application_method": "Apply once at land prep or early tillering"
                        }
                    },
                    {
                        "range": "P > 60 kg/ha",
                        "issues": [
                            "Micronutrient lockout (Zinc, Iron)",
                            "Nutrient imbalance"
                        ],
                        "diseases": [
                            "No direct disease but reduced Zn/Fe absorption may lead to deficiency symptoms"
                        ],
                        "fertilizer": {
                            "type": "DAP",
                            "recommended_kg_per_ha": "No DAP required",
                            "application_method": "Monitor for Zn deficiency; avoid further P use"
                        }
                    }
                ]
            },
            {
                "nutrient": "Potassium (K)",
                "conditions": [
                    {
                        "range": "K < 40 kg/ha",
                        "issues": [
                            "Leaf margin yellowing or scorching",
                            "Weak stems",
                            "Increased lodging",
                            "Poor water regulation"
                        ],
                        "diseases": [
                            "Brown Spot",
                            "Narrow Brown Spot",
                            "Increased bacterial blight susceptibility"
                        ],
                        "fertilizer": {
                            "type": "MOP",
                            "recommended_kg_per_ha": "40–50",
                            "application_method": "Split into basal + tillering stage"
                        }
                    },
                    {
                        "range": "40 ≤ K ≤ 60 kg/ha",
                        "issues": [
                            "Slight lodging risk",
                            "Mild leaf edge discoloration"
                        ],
                        "diseases": [
                            "Weakened stress tolerance"
                        ],
                        "fertilizer": {
                            "type": "MOP",
                            "recommended_kg_per_ha": "20–30",
                            "application_method": "Apply once at early vegetative stage"
                        }
                    },
                    {
                        "range": "K > 60 kg/ha",
                        "issues": [
                            "Reduced Mg and Zn uptake",
                            "Inhibited flowering under low light"
                        ],
                        "diseases": [
                            "Indirect effects due to nutrient imbalance"
                        ],
                        "fertilizer": {
                            "type": "MOP",
                            "recommended_kg_per_ha": "No MOP required",
                            "application_method": "Stop potash use; check for secondary deficiency"
                        }
                    }
                ]
            }
        ];

        // DOM elements
        const districtSelect = document.getElementById('district');
        const soilPhInput = document.getElementById('soilPh');
        const soilMoistureInput = document.getElementById('soilMoisture');
        const soilTextureInput = document.getElementById('soilTexture');
        const nitrogenInput = document.getElementById('nitrogen');
        const phosphorusInput = document.getElementById('phosphorus');
        const potassiumInput = document.getElementById('potassium');
        const temperatureInput = document.getElementById('temperature');
        const humidityInput = document.getElementById('humidity');
        const rainfallInput = document.getElementById('rainfall');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultsContainer = document.getElementById('resultsContainer');
        const diseaseBtn = document.getElementById('diseaseBtn');
        const diseaseModal = document.getElementById('diseaseModal');
        const closeModal = document.getElementById('closeModal');
        const diseaseTableBody = document.querySelector('#diseaseModal tbody');
        const fertilizerModal = document.getElementById('fertilizerModal');
        const closeFertilizerModal = document.getElementById('closeFertilizerModal');
        const fertilizerDetails = document.getElementById('fertilizerDetails');

        // Event listeners
        districtSelect.addEventListener('change', fillDistrictData);
        calculateBtn.addEventListener('click', calculateResults);
        resetBtn.addEventListener('click', resetForm);
        diseaseBtn.addEventListener('click', showDiseaseModal);
        closeModal.addEventListener('click', hideDiseaseModal);
        closeFertilizerModal.addEventListener('click', hideFertilizerModal);

        // Populate disease table
        function populateDiseaseTable() {
            diseaseTableBody.innerHTML = '';
            diseaseData.forEach(disease => {
                const row = document.createElement('tr');
                row.className = 'disease-row';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${disease.name}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-gray-500">${disease.triggers}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-gray-500">${disease.symptoms}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-gray-500">${disease.prevention}</td>
                `;
                diseaseTableBody.appendChild(row);
            });
        }

        // Show disease modal
        function showDiseaseModal() {
            populateDiseaseTable();
            diseaseModal.classList.remove('hidden');
        }

        // Hide disease modal
        function hideDiseaseModal() {
            diseaseModal.classList.add('hidden');
        }

        // Show fertilizer modal
        function showFertilizerModal(nitrogen, phosphorus, potassium) {
            fertilizerDetails.innerHTML = generateFertilizerDetails(nitrogen, phosphorus, potassium);
            fertilizerModal.classList.remove('hidden');
        }

        // Hide fertilizer modal
        function hideFertilizerModal() {
            fertilizerModal.classList.add('hidden');
        }

        // Generate fertilizer details
        function generateFertilizerDetails(nitrogen, phosphorus, potassium) {
            let html = '<div class="space-y-6">';
            
            // Nitrogen recommendations
            html += '<div class="bg-blue-50 p-4 rounded-lg">';
            html += '<h4 class="font-bold text-blue-800 mb-2">Nitrogen (N) Recommendations</h4>';
            
            const nCondition = getFertilizerCondition('Nitrogen (N)', nitrogen);
            html += `<p class="font-medium">Current level: ${nitrogen} kg/ha (${nCondition.range})</p>`;
            
            html += '<div class="mt-2">';
            html += '<h5 class="font-semibold text-sm text-gray-700">Potential Issues:</h5>';
            html += '<ul class="list-disc pl-5 text-sm text-gray-600">';
            nCondition.issues.forEach(issue => {
                html += `<li>${issue}</li>`;
            });
            html += '</ul>';
            html += '</div>';
            
            html += '<div class="mt-2">';
            html += '<h5 class="font-semibold text-sm text-gray-700">Disease Risks:</h5>';
            html += '<ul class="list-disc pl-5 text-sm text-gray-600">';
            nCondition.diseases.forEach(disease => {
                html += `<li>${disease}</li>`;
            });
            html += '</ul>';
            html += '</div>';
            
           
            html += '</div>';
            html += '</div>';
            
            // Phosphorus recommendations
            html += '<div class="bg-purple-50 p-4 rounded-lg">';
            html += '<h4 class="font-bold text-purple-800 mb-2">Phosphorus (P) Recommendations</h4>';
            
            const pCondition = getFertilizerCondition('Phosphorus (P)', phosphorus);
            html += `<p class="font-medium">Current level: ${phosphorus} kg/ha (${pCondition.range})</p>`;
            
            html += '<div class="mt-2">';
            html += '<h5 class="font-semibold text-sm text-gray-700">Potential Issues:</h5>';
            html += '<ul class="list-disc pl-5 text-sm text-gray-600">';
            pCondition.issues.forEach(issue => {
                html += `<li>${issue}</li>`;
            });
            html += '</ul>';
            html += '</div>';
            
            html += '<div class="mt-2">';
            html += '<h5 class="font-semibold text-sm text-gray-700">Disease Risks:</h5>';
            html += '<ul class="list-disc pl-5 text-sm text-gray-600">';
            pCondition.diseases.forEach(disease => {
                html += `<li>${disease}</li>`;
            });
            html += '</ul>';
            html += '</div>';
            
          
            html += '</div>';
            html += '</div>';
            
            // Potassium recommendations
            html += '<div class="bg-green-50 p-4 rounded-lg">';
            html += '<h4 class="font-bold text-green-800 mb-2">Potassium (K) Recommendations</h4>';
            
            const kCondition = getFertilizerCondition('Potassium (K)', potassium);
            html += `<p class="font-medium">Current level: ${potassium} kg/ha (${kCondition.range})</p>`;
            
            html += '<div class="mt-2">';
            html += '<h5 class="font-semibold text-sm text-gray-700">Potential Issues:</h5>';
            html += '<ul class="list-disc pl-5 text-sm text-gray-600">';
            kCondition.issues.forEach(issue => {
                html += `<li>${issue}</li>`;
            });
            html += '</ul>';
            html += '</div>';
            
            html += '<div class="mt-2">';
            html += '<h5 class="font-semibold text-sm text-gray-700">Disease Risks:</h5>';
            html += '<ul class="list-disc pl-5 text-sm text-gray-600">';
            kCondition.diseases.forEach(disease => {
                html += `<li>${disease}</li>`;
            });
            html += '</ul>';
            html += '</div>';
            
            
            html += '</div>';
            html += '</div>';
            
            // General fertilizer schedule
            html += '<div class="bg-yellow-50 p-4 rounded-lg">';
            html += '<h4 class="font-bold text-yellow-800 mb-2">General Fertilizer Application Schedule</h4>';
            html += '<div class="overflow-x-auto">';
            html += '<table class="min-w-full divide-y divide-gray-200">';
            html += '<thead class="bg-yellow-100">';
            html += '<tr>';
            html += '<th class="px-4 py-2 text-left text-xs font-medium text-yellow-800 uppercase">Time</th>';
            html += '<th class="px-4 py-2 text-left text-xs font-medium text-yellow-800 uppercase">Fertilizer to Apply</th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody class="bg-yellow-50 divide-y divide-yellow-200">';
            html += '<tr>';
            html += '<td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">Basal (before/at transplanting)</td>';
            html += '<td class="px-4 py-2 whitespace-normal text-sm text-gray-700">40–50 kg Urea + Full DAP (100–130 kg) + 25–30 kg MOP + 25 kg ZnSO₄</td>';
            html += '</tr>';
            html += '<tr>';
            html += '<td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">Tillering Stage (20–25 DAT)</td>';
            html += '<td class="px-4 py-2 whitespace-normal text-sm text-gray-700">40–50 kg Urea + 20–25 kg MOP</td>';
            html += '</tr>';
            html += '<tr>';
            html += '<td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">Panicle Initiation (40–45 DAT)</td>';
            html += '<td class="px-4 py-2 whitespace-normal text-sm text-gray-700">40–50 kg Urea</td>';
            html += '</tr>';
            html += '</tbody>';
            html += '</table>';
            html += '</div>';
            html += '</div>';
            
            html += '</div>';
            return html;
        }

        // Get fertilizer condition based on value
        function getFertilizerCondition(nutrient, value) {
            const nutrientData = fertilizerData.find(item => item.nutrient === nutrient);
            if (!nutrientData) return null;
            
            for (const condition of nutrientData.conditions) {
                const range = condition.range;
                if (range.includes('<')) {
                    const parts = range.split('<');
                    const threshold = parseFloat(parts[1].split(' ')[0]);
                    if (value < threshold) return condition;
                } 
                else if (range.includes('≤')) {
                    const parts = range.split('≤');
                    const min = parseFloat(parts[0]);
                    const max = parseFloat(parts[1].split(' ')[2]);
                    if (value >= min && value <= max) return condition;
                }
                else if (range.includes('>')) {
                    const parts = range.split('>');
                    const threshold = parseFloat(parts[1].split(' ')[0]);
                    if (value > threshold) return condition;
                }
            }
            return nutrientData.conditions[0]; // Default to first condition
        }

        // Fill form with district data
        function fillDistrictData() {
            const district = districtSelect.value;
            if (district) {
                const data = districtData.find(d => d.district === district);
                if (data) {
                    soilPhInput.value = data.pH;
                    soilMoistureInput.value = data.moisture;
                    nitrogenInput.value = data.nitrogen;
                    phosphorusInput.value = data.phosphorus;
                    potassiumInput.value = data.potassium;
                    temperatureInput.value = data.temperature;
                    humidityInput.value = data.humidity;
                    rainfallInput.value = data.rainfall;
                    soilTextureInput.value = ""; // Reset soil texture as it's not in district data
                }
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('cropForm').reset();
            resultsContainer.innerHTML = `
                <div class="text-center py-8 text-gray-400">
                    <i class="fas fa-leaf text-4xl mb-2"></i>
                    <p>Enter parameters and click Calculate to see results</p>
                </div>
            `;
        }

        // Normalize value function
        function normalize(value, min, max, ideal) {
            if (value <= min || value >= max) return 0;
            if (value === ideal) return 1;
            
            // Calculate distance from ideal
            const distance = Math.abs(value - ideal);
            const maxDistance = Math.max(ideal - min, max - ideal);
            
            // Quadratic decay for more severe penalty as we move away from ideal
            return 1 - Math.pow(distance / maxDistance, 2);
        }

        // Calculate soil texture score
        function getSoilTextureScore(texture) {
            return soilTextureRatings[texture] || 0;
        }

        // Calculate results
        function calculateResults() {
            // Get input values
            const soilPh = parseFloat(soilPhInput.value) || 0;
            const soilMoisture = parseFloat(soilMoistureInput.value) || 0;
            const soilTexture = soilTextureInput.value;
            const nitrogen = parseFloat(nitrogenInput.value) || 0;
            const phosphorus = parseFloat(phosphorusInput.value) || 0;
            const potassium = parseFloat(potassiumInput.value) || 0;
            const temperature = parseFloat(temperatureInput.value) || 0;
            const humidity = parseFloat(humidityInput.value) || 0;
            const rainfall = parseFloat(rainfallInput.value) || 0;

            // Calculate scores
            const growthScore = (
                normalize(soilPh, 6.0, 6.8, 6.4) * 0.05 +
                normalize(soilMoisture, 70, 80, 75) * 0.15 +
                (soilTexture ? getSoilTextureScore(soilTexture.split(' ')[0]) / 5 * 0.10 : 0) + // 10% weight for soil texture
                normalize(nitrogen, 120, 150, 135) * 0.23 +
                normalize(phosphorus, 40, 60, 50) * 0.10 +
                normalize(potassium, 40, 60, 50) * 0.10 +
                normalize(temperature, 28, 32, 30) * 0.15 +
                normalize(humidity, 65, 85, 75) * 0.10 +
                normalize(rainfall, 1000, 1200, 1100) * 0.12
            ) * 100;

            const soilScore = (
                normalize(soilPh, 6.0, 6.8, 6.4) * 0.05 +
                normalize(soilMoisture, 70, 80, 75) * 0.15 +
                (soilTexture ? getSoilTextureScore(soilTexture.split(' ')[0]) / 5 * 0.20 : 0) + // Higher weight for soil texture in soil score
                normalize(nitrogen, 120, 150, 135) * 0.23 +
                normalize(phosphorus, 40, 60, 50) * 0.10 +
                normalize(potassium, 40, 60, 50) * 0.10
            ) * 100;

            const weatherScore = (
                normalize(temperature, 28, 32, 30) * 0.15 +
                normalize(humidity, 65, 85, 75) * 0.10 +
                normalize(rainfall, 1000, 1200, 1100) * 0.12
            ) * 100;

            // Calculate expected yield (2500-3300 range)
            const expectedYield = 2200 + (growthScore / 100) * (3200 - 2200);

            // Determine disease risk
            let diseaseRisk = "Low";
            let diseaseRiskColor = "text-green-600";
            if (humidity > 85 || nitrogen > 160) {
                diseaseRisk = "Medium";
                diseaseRiskColor = "text-yellow-600";
            }
            if (humidity > 90 || nitrogen > 180 || soilPh < 5.5 || soilPh > 7.5) {
                diseaseRisk = "High";
                diseaseRiskColor = "text-red-600";
            }

            // Determine match summary
            let matchSummary = "";
            let matchColor = "";
            if (growthScore >= 85) {
                matchSummary = "Excellent conditions for rice cultivation";
                matchColor = "text-green-600";
            } else if (growthScore >= 70) {
                matchSummary = "Good conditions for rice cultivation";
                matchColor = "text-blue-600";
            } else {
                matchSummary = "Unsuitable or risky conditions";
                matchColor = "text-red-600";
            }

            // Soil texture rating
            let soilTextureRating = "";
            if (soilTexture) {
                const textureName = soilTexture.split(' ')[0];
                const rating = soilTextureRatings[textureName] || 0;
                soilTextureRating = `
                    <div class="flex items-center mt-1">
                        <span class="text-sm text-gray-700 mr-2">Texture Rating:</span>
                        <span class="star-rating">
                            ${'★'.repeat(Math.floor(rating))}${rating % 1 >= 0.5 ? '½' : ''}${'☆'.repeat(5 - Math.ceil(rating))}
                        </span>
                    </div>
                `;
            }

            // Fertilizer recommendations
            let ureaRecommendation = "";
            if (nitrogen < 100) ureaRecommendation = "Add 60–80 kg/ha Urea (split basal + tillering)";
            else if (nitrogen < 120) ureaRecommendation = "Add 40–60 kg/ha Urea";
            else if (nitrogen > 150) ureaRecommendation = "No Urea needed";
            else ureaRecommendation = "Add 20–30 kg/ha Urea";

            let dapRecommendation = "";
            if (phosphorus < 40) dapRecommendation = "Add 50–60 kg/ha DAP";
            else if (phosphorus <= 60) dapRecommendation = "Add 30–40 kg/ha DAP";
            else dapRecommendation = "No DAP needed";

            let mopRecommendation = "";
            if (potassium < 40) mopRecommendation = "Add 40–50 kg/ha MOP";
            else if (potassium <= 60) mopRecommendation = "Add 20–30 kg/ha MOP";
            else mopRecommendation = "No MOP needed";

            // Display results
            resultsContainer.innerHTML = `
                <div class="bg-green-50 p-4 rounded-lg mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-medium text-green-800">Growth Score</h3>
                        <span class="text-xl font-bold text-green-700">${Math.round(growthScore)}/100</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="progress-bar bg-green-600 h-2.5 rounded-full" style="width: ${growthScore}%"></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-medium text-blue-800 mb-1">Expected Yield</h3>
                        <p class="text-2xl font-bold text-blue-700">${Math.round(expectedYield)} kg/ha</p>
                    </div>

                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h3 class="font-medium text-purple-800 mb-1">Disease Risk</h3>
                        <p class="text-2xl font-bold ${diseaseRiskColor}">${diseaseRisk}</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h3 class="font-medium text-yellow-800 mb-1">Soil Compatibility</h3>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-yellow-700 mr-2">${Math.round(soilScore)}%</span>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="progress-bar bg-yellow-500 h-2.5 rounded-full" style="width: ${soilScore}%"></div>
                            </div>
                        </div>
                        ${soilTextureRating}
                    </div>

                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <h3 class="font-medium text-indigo-800 mb-1">Weather Compatibility</h3>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-indigo-700 mr-2">${Math.round(weatherScore)}%</span>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="progress-bar bg-indigo-500 h-2.5 rounded-full" style="width: ${weatherScore}%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                    <h3 class="font-medium text-gray-800 mb-1">Match Summary</h3>
                    <p class="text-lg font-semibold ${matchColor}">${matchSummary}</p>
                </div>

                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium text-gray-800">Fertilizer Recommendations</h3>
                        <button id="viewDetailsBtn" class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded hover:bg-green-200">
                            View Details
                        </button>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-start">
                            <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded mr-2">Urea</span>
                            <p>${ureaRecommendation}</p>
                        </div>
                        <div class="flex items-start">
                            <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mr-2">DAP</span>
                            <p>${dapRecommendation}</p>
                        </div>
                        <div class="flex items-start">
                            <span class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded mr-2">MOP</span>
                            <p>${mopRecommendation}</p>
                        </div>
                    </div>
                </div>
            `;

            // Add event listener for view details button
            document.getElementById('viewDetailsBtn').addEventListener('click', () => {
                showFertilizerModal(nitrogen, phosphorus, potassium);
            });
        }

        // Initialize disease table
        populateDiseaseTable();
    </script>
</body>
</html>


